# Local/bootstrap configuration only
# Service-specific configuration is managed by Spring Cloud Config Server
spring:
  application:
    name: user-service
  config:
    import: optional:configserver:${CONFIG_SERVER_URL}
  cloud:
    config:
      uri: ${CONFIG_SERVER_URL}
      fail-fast: false
      retry:
        initial-interval: 1000
        max-attempts: 6
        max-interval: 2000
        multiplier: 1.1
  
keycloak:
  initializer:
    enabled: ${KEYCLOAK_INITIALIZER_ENABLED:true}
    admin:
      url: ${KEYCLOAK_SERVER_URL}
      username: ${KEYCLOAK_ADMIN}
      password: ${KEYCLOAK_ADMIN_PASSWORD}
      client-id: ${KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    realm:
      name: ${KEYCLOAK_REALM:school-management}
      enabled: true
      attributes: {}
    clients:
      - client-id: ${USER_PROFILE_CLIENT_ID}
        protocol: openid-connect
        public-client: false
        service-accounts-enabled: true
        redirect-uris:
          - http://localhost:8080/*
          - https://api.school.visor.com/*
        web-origins:
          - "+"
        attributes:
          access-token-lifespan: "300"
          client-session-idle-timeout: "1800"
          client-session-max-lifespan: "36000"
      - client-id: ${USER_PROFILE_CLIENT_ID}
        protocol: openid-connect
        public-client: false
        service-accounts-enabled: true
        secret: ${USER_PROFILE_CLIENT_SECRET}
        redirect-uris: []
        web-origins: []
        attributes:
          access-token-lifespan: "600"
    realm-roles:
      - name: SUPER_ADMIN
        description: Super administrator with full system access including administrator management
      - name: ADMIN
        description: System administrator with full access
      - name: TEACHER
        description: Teacher with class and grade management permissions
      - name: STUDENT
        description: Student with read access to own records
      - name: PARENT
        description: Parent with access to children's records
    client-roles:
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: COLLECT_ATTENDANCE
        description: Permission to collect attendance as class leader
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: MANAGE_ATTENDANCE
        description: Permission to manage attendance records
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: COLLECT_EXAM_RESULTS
        description: Permission to collect exam results (class teachers grades 7-12)
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: SUBMIT_REPORTS
        description: Permission to submit reports to school administration
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: VIEW_ALL_STUDENTS
        description: Permission to view all student records
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: MANAGE_GRADES
        description: Permission to record and modify grades
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: MANAGE_HOMEROOM
        description: Permission to manage homeroom class (grades 1-6)
      - client-id: ${USER_PROFILE_CLIENT_ID}
        name: MANAGE_ADMINISTRATORS
        description: Permission to create, update, and manage administrator accounts
    composites:
      - realm-role: SUPER_ADMIN
        client-id: ${USER_PROFILE_CLIENT_ID}
        client-roles:
          - COLLECT_ATTENDANCE
          - MANAGE_ATTENDANCE
          - COLLECT_EXAM_RESULTS
          - SUBMIT_REPORTS
          - VIEW_ALL_STUDENTS
          - MANAGE_GRADES
          - MANAGE_HOMEROOM
          - MANAGE_ADMINISTRATORS
      - realm-role: ADMIN
        client-id: ${USER_PROFILE_CLIENT_ID}
        client-roles:
          - COLLECT_ATTENDANCE
          - MANAGE_ATTENDANCE
          - COLLECT_EXAM_RESULTS
          - SUBMIT_REPORTS
          - VIEW_ALL_STUDENTS
          - MANAGE_GRADES
          - MANAGE_HOMEROOM
      - realm-role: TEACHER
        client-id: ${USER_PROFILE_CLIENT_ID}
        client-roles:
          - MANAGE_ATTENDANCE
          - MANAGE_GRADES
    retry:
      max-attempts: ${KEYCLOAK_INITIALIZER_MAX_ATTEMPTS:5}
      initial-backoff-millis: ${KEYCLOAK_INITIALIZER_BACKOFF:2000}
      multiplier: ${KEYCLOAK_INITIALIZER_BACKOFF_MULTIPLIER:1.5}
      fail-on-error: ${KEYCLOAK_INITIALIZER_FAIL_ON_ERROR:false}
